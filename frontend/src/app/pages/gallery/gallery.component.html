<div class="page-bg">
  <app-dots-background [count]="22"></app-dots-background>
  <app-header></app-header>
  <div class="gallery-grid">
    <div class="gallery-card" *ngFor="let item of galleryItems;" (click)="openModal(item)">
      <button *ngIf="isCurrentUserOwner(item)" class="cancel-upload" (click)="$event.stopPropagation(); removeItem(item)">✕</button>

      <ng-container *ngIf="item.video; else photoTpl">
        <video [src]="item.video" preload="metadata" controls class="card-image" style="background:#000"></video>
      </ng-container>
      <ng-template #photoTpl>
        <img *ngIf="item.photo" [src]="item.photo" [alt]="'Post by ' + item.userName" class="card-image">
      </ng-template>
      <div class="card-content">
        <div class="user-info">
          <img [src]="item.userPhoto" [alt]="item.userName" class="user-avatar">
          <div class="user-details">
            <div class="user-name">{{ item.userName }}</div>
            <div class="post-date">{{ formatDate(item.date) }}</div>
          </div>
        </div>
        <p class="card-message">{{ item.message }}</p>
        <div class="card-actions">
          <button class="btn-icon" (click)="$event.stopPropagation(); share(item)" title="Compartilhar">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="3"></circle>
              <circle cx="6" cy="12" r="3"></circle>
              <circle cx="18" cy="19" r="3"></circle>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de confirmação de exclusão -->
  <div class="modal-backdrop" *ngIf="itemToDelete" (click)="cancelDelete()">
    <div class="modal-content delete-confirm-modal" (click)="$event.stopPropagation()">
      <h3>Confirmar exclusão</h3>
      <p>Tem certeza que deseja excluir esta publicação?</p>
      <div class="modal-actions">
        <button class="btn-secondary modal-btn" (click)="cancelDelete()">Cancelar</button>
        <button class="btn-gradient modal-btn" (click)="confirmDelete()">Excluir</button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal-backdrop" *ngIf="selectedItem" (click)="closeModal()">
    <button class="modal-close">✕</button>
    <div class="modal-content" (click)="$event.stopPropagation()">
      <ng-container *ngIf="selectedItem.video; else modalPhoto">
        <video [src]="selectedItem.video" controls autoplay preload="auto" class="modal-image" style="background:#000"></video>
      </ng-container>
      <ng-template #modalPhoto>
        <img *ngIf="selectedItem.photo" [src]="selectedItem.photo" [alt]="'Post by ' + selectedItem.userName" class="modal-image">
      </ng-template>
      <div class="modal-details">
        <div class="modal-user-info">
          <img [src]="selectedItem.userPhoto" [alt]="selectedItem.userName" class="modal-avatar">
          <div class="user-details">
            <div class="user-name">{{ selectedItem.userName }}</div>
            <div class="post-date">{{ formatDate(selectedItem.date) }}</div>
          </div>
        </div>
        <p class="modal-message">{{ selectedItem.message }}</p>
        <div class="modal-actions">
          <!-- Botão de compartilhar -->
          <button class="btn-icon share-btn-modal" (click)="share(selectedItem)" title="Compartilhar">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="3"></circle>
              <circle cx="6" cy="12" r="3"></circle>
              <circle cx="18" cy="19" r="3"></circle>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
          </button>
          <!-- Botão de excluir (apenas para o criador) -->
          <button *ngIf="isCurrentUserOwner(selectedItem)" class="btn-icon delete-btn-modal" (click)="removeItem(selectedItem)" title="Excluir">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="3,6 5,6 21,6"></polyline>
              <path d="m19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"></path>
              <line x1="10" y1="11" x2="10" y2="17"></line>
              <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
          </button>
        </div>

      </div>
    </div>
  </div>
</div>
