<div class="interaction-page">
  <!-- global dots background for this page (behind everything) -->
  <app-dots-background [count]="20"></app-dots-background>
  <app-header></app-header>

  <!-- Main container -->
  <main class="interaction-main">
    <section class="title-block">
      <h1>Compartilhe o Amor</h1>
      <p>Sua presen√ßa √© nosso maior presente! Ajude a eternizar este momento enviando suas fotos, v√≠deos e mensagens de carinho.</p>
    </section>

    <div class="cta-stack">
      <button class="cta cta-primary" (click)="openPhotoCapture()">
        <span>Envie Fotos/V√≠deos da Festa</span>
      </button>
      <button class="cta cta-secondary" (click)="openVideoCapture()">
        <span>Deixe seu depoimento em v√≠deo</span>
      </button>
    </div>

    <hr class="section-separator" />

    <section class="message-area">
      <h2>Ou deixe uma mensagem especial</h2>

      <!-- Upload dashed √°rea ou preview -->
        <div class="upload-dashed" (click)="openPhotoCapture()" *ngIf="!photoPreviewUrl && !isReadingPhoto; else photoPreview">
          <div class="upload-icon">üì∑</div>
          <div class="upload-text">
            <strong>Adicionar foto</strong>
            <small>Clique para escolher uma imagem</small>
          </div>
        </div>
        <ng-template #photoPreview>
          <div class="upload-preview">
            <div class="preview-inner" *ngIf="isReadingPhoto; else showPreview">
              <div class="upload-icon">‚è≥</div>
              <div class="upload-text">
                <strong>Lendo imagem...</strong>
                <small>Aguarde ou cancele o upload</small>
              </div>
              <button class="cancel-upload" (click)="cancelUpload()">Cancelar</button>
            </div>
            <ng-template #showPreview>
              <div class="preview-inner">
                <div class="upload-preview-container">
                  <div class="upload-preview" (click)="openPhotoCapture()">
                    <img [src]="photoPreviewUrl!" alt="Pr√©-visualiza√ß√£o da imagem" />
                  </div>
                  <button class="cancel-upload" (click)="cancelUpload()">‚úï</button>
                </div>
              </div>
            </ng-template>
          </div>
        </ng-template>

        <!-- Preview de v√≠deo -->
        <div class="upload-preview" *ngIf="videoPreviewUrl">
          <div class="preview-inner">
            <div class="upload-preview-container">
              <div class="upload-preview">
                <video [src]="videoPreviewUrl" controls preload="metadata" style="width: 100%; max-height: 200px;"></video>
              </div>
              <button class="cancel-upload" (click)="cancelUpload()">‚úï</button>
            </div>
          </div>
        </div>

      <div class="textarea-wrap">
        <textarea [(ngModel)]="message" [maxlength]="maxLength" placeholder="Escreva sua mensagem aqui... (at√© 5000 caracteres)"></textarea>
        <div class="char-count">{{ remainingCharacters }} caracteres restantes</div>
      </div>

  <button
    class="send-button"
    (click)="submitMessage()"
    [class.has-content]="message.trim() || selectedPhoto || selectedVideo || photoPreviewUrl"
    [disabled]="isUploading || (!message.trim() && !selectedPhoto && !selectedVideo && !photoPreviewUrl)">
    <span *ngIf="!isUploading">{{ (message.trim() || selectedPhoto || selectedVideo || photoPreviewUrl) ? 'Enviar Mensagem' : 'Envie sua mensagem' }}</span>
    <span *ngIf="isUploading">Enviando... Por favor aguarde</span>
  </button>
    </section>
  </main>

  <!-- Entradas ocultas para captura de c√¢mera/arquivo -->
  <input type="file" id="videoInput" accept="video/*" capture style="display:none" (change)="onVideoSelected($event)">
  <input type="file" id="photoInput" accept="image/*" capture="environment" style="display:none" (change)="onPhotoSelected($event)">
</div>
